<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>Srebrne Antosie 2025</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #0f0f0f;
  color: white;
  display: flex;
  flex-direction: column;
  min-height: 100vh;
  position: relative;
}

header {
  position: relative;
  text-align: center;
  height: 150px;
  background: #111;
  z-index: 3;
}

header img {
  max-height: 120px;
  margin-top: 15px;
}

#bgLogo {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: url('Srebrne_Antosie_2025.png') no-repeat center center;
  background-size: cover;
  filter: blur(15px) brightness(0.3);
  z-index: 0;
  pointer-events: none; /* nie przeszkadza w klikaniu */
}

#slider {
  flex: 1;
  display: flex;
  justify-content: center;
  align-items: center;
  position: relative;
  z-index: 2;
}

.category {
  width: 100%;
  max-width: 1000px;
  padding: 20px;
  position: relative;
}

.category h2 {
  color: #b0b0b0;
  text-align: center;
}

.grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
  gap: 15px;
  justify-items: center;
}

.card {
  width: 100%;
  max-width: 250px;
  background: rgba(26,26,26,0.8);
  padding: 10px;
  border-radius: 10px;
  text-align: center;
  cursor: pointer;
  border: 2px solid transparent;
  transition: 0.2s;
}

.card.selected {
  border: 2px solid white;
  background: #333;
}

.card.voted {
  opacity: 0.4;
  pointer-events: none;
}

.card video {
  width: 100%;
  height: 220px;
  object-fit: cover;
  border-radius: 8px;
}

button {
  margin-top: 10px;
  padding: 8px 15px;
  border: none;
  border-radius: 5px;
  background: #b0b0b0;
  cursor: pointer;
  font-weight: bold;
}

button:hover:not(:disabled) {
  background: #888;
}

button:disabled {
  background: #555;
  cursor: not-allowed;
}

#nav {
  text-align: center;
  margin: 10px 0;
  z-index: 2;
}

#adminBar {
  background: #111;
  padding: 15px;
  text-align: center;
  z-index: 2;
}

#adminPanel {
  display: none;
  margin-top: 10px;
}

.result {
  background: #222;
  margin: 5px;
  padding: 10px;
  border-radius: 8px;
}

#thanksSlide {
  text-align: center;
  font-size: 2em;
  color: #b0b0b0;
}
</style>
</head>

<body>

<header>
  <img src="Srebrne_Antosie_2025.png" alt="Srebrne Antosie 2025 Logo">
</header>

<div id="bgLogo"></div>

<div id="slider"></div>

<div id="nav">
  <button onclick="prevCategory()">‚¨Ö Poprzednia</button>
  <button onclick="nextCategory()">Nastƒôpna kategoria ‚û°</button>
</div>

<div id="adminBar">
  Tajny panel:
  <a href="#" onclick="showLogin()" style="color:#b0b0b0">Admin</a>

  <div id="adminPanel">
    <h3>Panel Admina</h3>
    <div id="results"></div>
    <button onclick="resetVotes()">RESETUJ WSZYSTKIE G≈ÅOSY</button>
  </div>
</div>

<script>
const ADMIN_LOGIN = "wronki";
const ADMIN_PASSWORD = "ojciec";

const categories = [
  "Rage Roku (klip)",
  "Smutek (klip)",
  "M≈Çodzie≈ºowe Zdanie (klip)",
  "ZajƒÖkanie siƒô (klip)",
  "Gracz Roku (osoba)",
  "Zagranie Roku (klip)",
  "Osoba kt√≥ra powinna dotknƒÖƒá trawy (osoba)",
  "Najgorsze Zagranie (klip)",
  "Kierowca Roku (klip)",
  "Porada Roku (klip)"
];

let currentIndex = 0;
let selectedOption = {};
let userIP = null;

// ---------------- IP ----------------
async function fetchIP() {
  try {
    const res = await fetch("https://api.ipify.org?format=json");
    const data = await res.json();
    userIP = data.ip;
  } catch {
    alert("Nie uda≈Ço siƒô pobraƒá IP");
  }
}

// ---------------- STORAGE ----------------
function getVotes() {
  return JSON.parse(localStorage.getItem("votes") || "{}");
}

function saveVotes(votes) {
  localStorage.setItem("votes", JSON.stringify(votes));
}

function getIPLocks() {
  return JSON.parse(localStorage.getItem("ipLocks") || "{}");
}

function saveIPLocks(data) {
  localStorage.setItem("ipLocks", JSON.stringify(data));
}

// ---------------- UI ----------------
function renderCategory() {
  const slider = document.getElementById("slider");
  slider.innerHTML = "";

  if (currentIndex >= categories.length) {
    const div = document.createElement("div");
    div.id = "thanksSlide";
    div.innerText = "üéâ Dziƒôkujemy za g≈Çosy! üéâ";
    slider.appendChild(div);
    return;
  }

  const cat = categories[currentIndex];
  const div = document.createElement("div");
  div.className = "category";

  div.innerHTML = `
    <h2>${currentIndex + 1}/10 ‚Äî ${cat}</h2>
    <div class="grid">
      ${[1,2,3,4].map(i => `
        <div class="card" onclick="selectCard('${cat}', 'Opcja ${i}', this)">
          <video src="klip${currentIndex + 1}_${i}.mp4" controls></video>
          <button onclick="event.stopPropagation(); vote('${cat}', this.parentElement)">
            G≈Çosuj
          </button>
        </div>
      `).join("")}
    </div>
  `;

  slider.appendChild(div);
  lockIfVoted();
}

function nextCategory() {
  if (currentIndex < categories.length) {
    currentIndex++;
    renderCategory();
  }
}

function prevCategory() {
  if (currentIndex > 0) {
    currentIndex--;
    renderCategory();
  }
}

// ---------------- VOTING ----------------
function selectCard(category, option, card) {
  if (!userIP) return;

  const locks = getIPLocks();
  if (locks[userIP] && locks[userIP][category]) return;

  const cards = card.parentElement.querySelectorAll(".card");
  cards.forEach(c => c.classList.remove("selected"));

  card.classList.add("selected");
  selectedOption[category] = option;
}

function vote(category, card) {
  if (!userIP) {
    alert("≈Åadowanie IP...");
    return;
  }

  const locks = getIPLocks();
  if (locks[userIP] && locks[userIP][category]) {
    alert("Ju≈º zag≈Çosowa≈Çe≈õ w tej kategorii!");
    return;
  }

  const option = selectedOption[category];
  if (!option) {
    alert("Najpierw wybierz klip!");
    return;
  }

  const votes = getVotes();
  if (!votes[category]) votes[category] = {};
  if (!votes[category][option]) votes[category][option] = 0;
  votes[category][option]++;
  saveVotes(votes);

  if (!locks[userIP]) locks[userIP] = {};
  locks[userIP][category] = true;
  saveIPLocks(locks);

  lockIfVoted();
  alert("G≈Ços zapisany! üèÜ");

  nextCategory();
}

function lockIfVoted() {
  const cat = categories[currentIndex];
  const locks = getIPLocks();

  if (locks[userIP] && locks[userIP][cat]) {
    document.querySelectorAll(".card").forEach(c => {
      c.classList.add("voted");
    });
  }
}

// ---------------- ADMIN ----------------
function showLogin() {
  const login = prompt("Login:");
  const pass = prompt("Has≈Ço:");

  if (login === ADMIN_LOGIN && pass === ADMIN_PASSWORD) {
    document.getElementById("adminPanel").style.display = "block";
    showResults();
  } else {
    alert("Z≈Çy login lub has≈Ço!");
  }
}

function showResults() {
  const votes = getVotes();
  const results = document.getElementById("results");
  results.innerHTML = "";

  for (let cat in votes) {
    const div = document.createElement("div");
    div.className = "result";

    let html = `<strong>${cat}</strong><br>`;
    for (let opt in votes[cat]) {
      html += `${opt}: ${votes[cat][opt]} g≈Ços√≥w<br>`;
    }

    div.innerHTML = html;
    results.appendChild(div);
  }
}

function resetVotes() {
  if (confirm("Na pewno zresetowaƒá wszystkie g≈Çosy i IP?")) {
    localStorage.removeItem("votes");
    localStorage.removeItem("ipLocks");
    alert("Zresetowano wszystko!");
    location.reload();
  }
}

// ---------------- INIT ----------------
fetchIP().then(renderCategory);
</script>

</body>
</html>

